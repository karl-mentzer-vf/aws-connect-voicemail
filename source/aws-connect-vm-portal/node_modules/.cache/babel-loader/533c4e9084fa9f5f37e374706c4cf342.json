{"ast":null,"code":"import _classCallCheck from\"/home/ec2-user/environment/aws-connect-voicemail/source/aws-connect-vm-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ec2-user/environment/aws-connect-voicemail/source/aws-connect-vm-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/import rp from'request-promise';import{Auth}from'aws-amplify';import AuthDto from\"../dto/auth.dto\";var HttpMethod={POST:\"POST\",GET:\"GET\",PATCH:\"PATCH\"};var ApiService=/*#__PURE__*/function(){function ApiService(){_classCallCheck(this,ApiService);this.baseUrl=process.env.REACT_APP_BASE_API;this.apiKey=process.env.REACT_APP_API_KEY;}_createClass(ApiService,[{key:\"getAgents\",value:function getAgents(next){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/agents\"),{next:next},this.getAuth());}},{key:\"getGlobalSettings\",value:function getGlobalSettings(){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/global/settings\"),null,this.getAuth()).then(function(result){return result.settings;});}},{key:\"getContactFlow\",value:function getContactFlow(contactFlowDto){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/contact/flow\"),contactFlowDto,this.getAuth()).then(function(result){return result.contactFlow;});}},{key:\"syncAgent\",value:function syncAgent(){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/agents/sync\"),null,this.getAuth());}},{key:\"updateAgentSettings\",value:function updateAgentSettings(agentId,agentRequest){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/agents/\").concat(agentId),agentRequest,this.getAuth()).then(function(result){return result.agent;});}},{key:\"getAgent\",value:function getAgent(agentId){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/agents/\").concat(agentId),null,this.getAuth());}},{key:\"saveGlobalSettings\",value:function saveGlobalSettings(settings){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/global/settings\"),settings,this.getAuth()).then(function(result){return result.settings;});}},{key:\"_getHeader\",value:function _getHeader(auth){var header={'x-api-key':this.apiKey};if(auth){header['Authorization']=\"Bearer \".concat(auth.idToken);}// console.log(\"The header\", header);\nreturn header;}},{key:\"getAuth\",value:function getAuth(){return Auth.currentSession().then(function(session){return new AuthDto({idToken:session.getIdToken().getJwtToken(),accessToken:session.getAccessToken().getJwtToken(),refreshToken:session.getRefreshToken().getToken()});});}},{key:\"request\",value:function request(method,uri,body){var _this=this;var auth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Promise.resolve(null);if(method===HttpMethod.POST){return auth.then(function(auth){return _this._post(uri,body,auth);});}else if(method===HttpMethod.GET){return auth.then(function(auth){return _this._get(uri,body,auth);});}else if(method===HttpMethod.PATCH){return auth.then(function(auth){return _this._patch(uri,body,auth);});}else{return Promise.resolve();}}},{key:\"_post\",value:function _post(uri){var body=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var options={method:HttpMethod.POST,uri:uri,body:body,headers:this._getHeader(auth),json:true};return rp(options);}},{key:\"_get\",value:function _get(uri,qs){var auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var options={method:HttpMethod.GET,uri:uri,qs:qs,headers:this._getHeader(auth),json:true};return rp(options);}},{key:\"_patch\",value:function _patch(uri){var body=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var options={method:HttpMethod.PATCH,uri:uri,body:body,headers:this._getHeader(auth),json:true};return rp(options);}}]);return ApiService;}();export{ApiService};","map":{"version":3,"names":["rp","Auth","AuthDto","HttpMethod","POST","GET","PATCH","ApiService","_classCallCheck","baseUrl","process","env","REACT_APP_BASE_API","apiKey","REACT_APP_API_KEY","_createClass","key","value","getAgents","next","request","concat","getAuth","getGlobalSettings","then","result","settings","getContactFlow","contactFlowDto","contactFlow","syncAgent","updateAgentSettings","agentId","agentRequest","agent","getAgent","saveGlobalSettings","_getHeader","auth","header","idToken","currentSession","session","getIdToken","getJwtToken","accessToken","getAccessToken","refreshToken","getRefreshToken","getToken","method","uri","body","_this","arguments","length","undefined","Promise","resolve","_post","_get","_patch","options","headers","json","qs"],"sources":["/home/ec2-user/environment/aws-connect-voicemail/source/aws-connect-vm-portal/src/service/api.service.ts"],"sourcesContent":["/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/\n\nimport rp from 'request-promise';\nimport { Auth } from 'aws-amplify';\nimport { AuthInterface } from \"../interface/auth.interface\";\nimport { GlobalSettingsInterface } from \"../interface/global-settings.interface\";\nimport { AgentInterface, BasicAgentInterface } from \"../interface/agent.interface\";\nimport AgentRequestDto from \"../dto/agent-request.dto\";\nimport ContactFlowDto from \"../dto/contact-flow.dto\";\nimport AuthDto from \"../dto/auth.dto\";\nimport { PageInterface } from \"../interface/page.interface\";\n\nconst HttpMethod = {\n  POST: \"POST\",\n  GET: \"GET\",\n  PATCH: \"PATCH\"\n};\n\nclass ApiService {\n\n  baseUrl = process.env.REACT_APP_BASE_API;\n  apiKey = process.env.REACT_APP_API_KEY;\n\n  getAgents(next: string | null): Promise<PageInterface<BasicAgentInterface>> {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/agents`, {\n      next\n    }, this.getAuth());\n  }\n\n  getGlobalSettings() {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/global/settings`, null, this.getAuth())\n      .then(result => result.settings);\n  }\n\n  getContactFlow(contactFlowDto: ContactFlowDto) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/contact/flow`, contactFlowDto, this.getAuth())\n      .then(result => result.contactFlow)\n  }\n\n  syncAgent() {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/agents/sync`, null, this.getAuth());\n  }\n\n  updateAgentSettings(agentId: string, agentRequest: AgentRequestDto) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/agents/${agentId}`, agentRequest, this.getAuth())\n      .then(result => result.agent)\n  }\n\n  getAgent(agentId: string): Promise<AgentInterface> {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/agents/${agentId}`, null, this.getAuth())\n  }\n\n  saveGlobalSettings(settings: GlobalSettingsInterface) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/global/settings`, settings, this.getAuth())\n      .then(result => result.settings);\n  }\n\n  _getHeader(auth: AuthInterface | null): object {\n    let header: any = {\n      'x-api-key': this.apiKey\n    };\n    if (auth) {\n      header['Authorization'] = `Bearer ${auth.idToken}`;\n    }\n    // console.log(\"The header\", header);\n    return header\n  }\n\n  getAuth(): Promise<AuthInterface | null> {\n    return Auth.currentSession()\n      .then(session => new AuthDto({\n        idToken: session.getIdToken().getJwtToken(),\n        accessToken: session.getAccessToken().getJwtToken(),\n        refreshToken: session.getRefreshToken().getToken()\n      }));\n  }\n\n  request(method: string, uri: string, body: object | null, auth: Promise<AuthInterface | null> = Promise.resolve(null)): Promise<any> {\n\n    if (method === HttpMethod.POST) {\n      return auth.then(auth => this._post(uri, body, auth));\n    } else if (method === HttpMethod.GET) {\n      return auth.then(auth => this._get(uri, body, auth));\n    } else if (method === HttpMethod.PATCH) {\n      return auth.then(auth => this._patch(uri, body, auth));\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _post(uri: string, body: object | null = {}, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.POST, uri, body, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n  _get(uri: string, qs: object | null, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.GET, uri, qs, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n  _patch(uri: string, body: object | null = {}, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.PATCH, uri, body, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n}\n\nexport { ApiService };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}