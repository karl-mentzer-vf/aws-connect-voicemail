{"ast":null,"code":"/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/import rp from'request-promise';import{Auth}from'aws-amplify';import AuthDto from\"../dto/auth.dto\";const HttpMethod={POST:\"POST\",GET:\"GET\",PATCH:\"PATCH\"};class ApiService{constructor(){this.baseUrl=process.env.REACT_APP_BASE_API;this.apiKey=process.env.REACT_APP_API_KEY;}getAgents(next){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/agents\"),{next},this.getAuth());}getGlobalSettings(){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/global/settings\"),null,this.getAuth()).then(result=>result.settings);}getContactFlow(contactFlowDto){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/contact/flow\"),contactFlowDto,this.getAuth()).then(result=>result.contactFlow);}syncAgent(){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/agents/sync\"),null,this.getAuth());}updateAgentSettings(agentId,agentRequest){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/agents/\").concat(agentId),agentRequest,this.getAuth()).then(result=>result.agent);}getAgent(agentId){return this.request(HttpMethod.GET,\"\".concat(this.baseUrl,\"/agents/\").concat(agentId),null,this.getAuth());}saveGlobalSettings(settings){return this.request(HttpMethod.POST,\"\".concat(this.baseUrl,\"/global/settings\"),settings,this.getAuth()).then(result=>result.settings);}_getHeader(auth){let header={'x-api-key':this.apiKey};if(auth){header['Authorization']=\"Bearer \".concat(auth.idToken);}// console.log(\"The header\", header);\nreturn header;}getAuth(){return Auth.currentSession().then(session=>new AuthDto({idToken:session.getIdToken().getJwtToken(),accessToken:session.getAccessToken().getJwtToken(),refreshToken:session.getRefreshToken().getToken()}));}request(method,uri,body){let auth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Promise.resolve(null);if(method===HttpMethod.POST){return auth.then(auth=>this._post(uri,body,auth));}else if(method===HttpMethod.GET){return auth.then(auth=>this._get(uri,body,auth));}else if(method===HttpMethod.PATCH){return auth.then(auth=>this._patch(uri,body,auth));}else{return Promise.resolve();}}_post(uri){let body=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let options={method:HttpMethod.POST,uri,body,headers:this._getHeader(auth),json:true};return rp(options);}_get(uri,qs){let auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let options={method:HttpMethod.GET,uri,qs,headers:this._getHeader(auth),json:true};return rp(options);}_patch(uri){let body=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let auth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let options={method:HttpMethod.PATCH,uri,body,headers:this._getHeader(auth),json:true};return rp(options);}}export{ApiService};","map":{"version":3,"names":["rp","Auth","AuthDto","HttpMethod","POST","GET","PATCH","ApiService","constructor","baseUrl","process","env","REACT_APP_BASE_API","apiKey","REACT_APP_API_KEY","getAgents","next","request","concat","getAuth","getGlobalSettings","then","result","settings","getContactFlow","contactFlowDto","contactFlow","syncAgent","updateAgentSettings","agentId","agentRequest","agent","getAgent","saveGlobalSettings","_getHeader","auth","header","idToken","currentSession","session","getIdToken","getJwtToken","accessToken","getAccessToken","refreshToken","getRefreshToken","getToken","method","uri","body","arguments","length","undefined","Promise","resolve","_post","_get","_patch","options","headers","json","qs"],"sources":["/home/ec2-user/environment/aws-connect-voicemail/source/aws-connect-vm-portal/src/service/api.service.ts"],"sourcesContent":["/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/\n\nimport rp from 'request-promise';\nimport { Auth } from 'aws-amplify';\nimport { AuthInterface } from \"../interface/auth.interface\";\nimport { GlobalSettingsInterface } from \"../interface/global-settings.interface\";\nimport { AgentInterface, BasicAgentInterface } from \"../interface/agent.interface\";\nimport AgentRequestDto from \"../dto/agent-request.dto\";\nimport ContactFlowDto from \"../dto/contact-flow.dto\";\nimport AuthDto from \"../dto/auth.dto\";\nimport { PageInterface } from \"../interface/page.interface\";\n\nconst HttpMethod = {\n  POST: \"POST\",\n  GET: \"GET\",\n  PATCH: \"PATCH\"\n};\n\nclass ApiService {\n\n  baseUrl = process.env.REACT_APP_BASE_API;\n  apiKey = process.env.REACT_APP_API_KEY;\n\n  getAgents(next: string | null): Promise<PageInterface<BasicAgentInterface>> {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/agents`, {\n      next\n    }, this.getAuth());\n  }\n\n  getGlobalSettings() {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/global/settings`, null, this.getAuth())\n      .then(result => result.settings);\n  }\n\n  getContactFlow(contactFlowDto: ContactFlowDto) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/contact/flow`, contactFlowDto, this.getAuth())\n      .then(result => result.contactFlow)\n  }\n\n  syncAgent() {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/agents/sync`, null, this.getAuth());\n  }\n\n  updateAgentSettings(agentId: string, agentRequest: AgentRequestDto) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/agents/${agentId}`, agentRequest, this.getAuth())\n      .then(result => result.agent)\n  }\n\n  getAgent(agentId: string): Promise<AgentInterface> {\n    return this.request(HttpMethod.GET, `${this.baseUrl}/agents/${agentId}`, null, this.getAuth())\n  }\n\n  saveGlobalSettings(settings: GlobalSettingsInterface) {\n    return this.request(HttpMethod.POST, `${this.baseUrl}/global/settings`, settings, this.getAuth())\n      .then(result => result.settings);\n  }\n\n  _getHeader(auth: AuthInterface | null): object {\n    let header: any = {\n      'x-api-key': this.apiKey\n    };\n    if (auth) {\n      header['Authorization'] = `Bearer ${auth.idToken}`;\n    }\n    // console.log(\"The header\", header);\n    return header\n  }\n\n  getAuth(): Promise<AuthInterface | null> {\n    return Auth.currentSession()\n      .then(session => new AuthDto({\n        idToken: session.getIdToken().getJwtToken(),\n        accessToken: session.getAccessToken().getJwtToken(),\n        refreshToken: session.getRefreshToken().getToken()\n      }));\n  }\n\n  request(method: string, uri: string, body: object | null, auth: Promise<AuthInterface | null> = Promise.resolve(null)): Promise<any> {\n\n    if (method === HttpMethod.POST) {\n      return auth.then(auth => this._post(uri, body, auth));\n    } else if (method === HttpMethod.GET) {\n      return auth.then(auth => this._get(uri, body, auth));\n    } else if (method === HttpMethod.PATCH) {\n      return auth.then(auth => this._patch(uri, body, auth));\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  _post(uri: string, body: object | null = {}, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.POST, uri, body, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n  _get(uri: string, qs: object | null, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.GET, uri, qs, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n  _patch(uri: string, body: object | null = {}, auth: AuthInterface | null = null) {\n    let options = { method: HttpMethod.PATCH, uri, body, headers: this._getHeader(auth), json: true };\n    return rp(options)\n  }\n\n}\n\nexport { ApiService };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}