{"ast":null,"code":"/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/import React from'react';import{connect}from'react-redux';import history from\"../history\";import{Auth}from\"aws-amplify\";import{AuthAction}from\"../store/actions/auth.actions\";export default function(ComposedComponent,UnauthedComponent){class Authenticate extends React.Component{constructor(props){super(props);this.state={authState:'loading'};}componentDidMount(){this._checkAndRedirect();}componentDidUpdate(){this._checkAndRedirect();}_checkAndRedirect(){if(this.state.authState===\"loading\"){Auth.currentAuthenticatedUser().then(user=>{this.props.auth(user);this.setState({authState:'valid'});}).catch(e=>{this.setState({authState:'invalid'});this.props.redirect();});}}render(){return this.state.authState==='valid'?/*#__PURE__*/React.createElement(ComposedComponent,this.props):/*#__PURE__*/React.createElement(UnauthedComponent,this.props);}}const mapStateToProps=state=>{return{auth:state.auth};};const mapDispatchToProps=dispatch=>{return{redirect:()=>dispatch(()=>{history.push(\"/login\");}),auth:user=>dispatch(AuthAction.auth(user))};};return connect(mapStateToProps,mapDispatchToProps)(Authenticate);}","map":{"version":3,"names":["React","connect","history","Auth","AuthAction","ComposedComponent","UnauthedComponent","Authenticate","Component","constructor","props","state","authState","componentDidMount","_checkAndRedirect","componentDidUpdate","currentAuthenticatedUser","then","user","auth","setState","catch","e","redirect","render","createElement","mapStateToProps","mapDispatchToProps","dispatch","push"],"sources":["/home/ec2-user/environment/aws-connect-voicemail/source/aws-connect-vm-portal/src/common/requiresAuth.js"],"sourcesContent":["/******************************************************************************\n *  Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.                                           *                                                                                                                   *\n *  Licensed under the Apache License Version 2.0 (the 'License'). You may not\n *  use this file except in compliance with the License. A copy of the License\n *  is located at                                                            \n *                                                                                                                   \n *      http://www.apache.org/licenses/                                                                                   *                                                                                                                  \n *  or in the 'license' file accompanying this file. This file is distributed on\n *  an 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n *  implied. See the License for the specific language governing permissions and\n *  limitations under the License.                                                                                \n******************************************************************************/\n\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport history from \"../history\";\nimport {Auth} from \"aws-amplify\";\nimport {AuthAction} from \"../store/actions/auth.actions\";\n\nexport default function (ComposedComponent, UnauthedComponent) {\n    class Authenticate extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                authState: 'loading'\n            }\n        }\n\n        componentDidMount() {\n            this._checkAndRedirect();\n        }\n\n        componentDidUpdate() {\n            this._checkAndRedirect();\n        }\n\n        _checkAndRedirect() {\n            if (this.state.authState === \"loading\") {\n                Auth.currentAuthenticatedUser().then(user => {\n                    this.props.auth(user);\n                    this.setState({authState: 'valid'});\n                }).catch(e => {\n                    this.setState({authState: 'invalid'});\n                    this.props.redirect();\n                });\n            }\n        }\n\n        render() {\n            return this.state.authState === 'valid' ?\n                <ComposedComponent {...this.props} /> : <UnauthedComponent {...this.props}/>;\n        }\n    }\n\n    const mapStateToProps = (state) => {\n        return {\n            auth: state.auth\n        };\n    };\n\n    const mapDispatchToProps = (dispatch) => {\n        return {\n            redirect: () => dispatch(() => {history.push(\"/login\")}),\n            auth: (user) => dispatch(AuthAction.auth(user))\n        }\n    };\n\n    return connect(\n        mapStateToProps,\n        mapDispatchToProps\n    )(Authenticate);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+EAEA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAAQC,OAAO,KAAO,aAAa,CACnC,MAAO,CAAAC,OAAO,KAAM,YAAY,CAChC,OAAQC,IAAI,KAAO,aAAa,CAChC,OAAQC,UAAU,KAAO,+BAA+B,CAExD,cAAe,UAAUC,iBAAiB,CAAEC,iBAAiB,CAAE,CAC3D,KAAM,CAAAC,YAAY,QAAS,CAAAP,KAAK,CAACQ,SAAU,CACvCC,WAAWA,CAACC,KAAK,CAAE,CACf,KAAK,CAACA,KAAK,CAAC,CACZ,IAAI,CAACC,KAAK,CAAG,CACTC,SAAS,CAAE,SACf,CAAC,CACL,CAEAC,iBAAiBA,CAAA,CAAG,CAChB,IAAI,CAACC,iBAAiB,CAAC,CAAC,CAC5B,CAEAC,kBAAkBA,CAAA,CAAG,CACjB,IAAI,CAACD,iBAAiB,CAAC,CAAC,CAC5B,CAEAA,iBAAiBA,CAAA,CAAG,CAChB,GAAI,IAAI,CAACH,KAAK,CAACC,SAAS,GAAK,SAAS,CAAE,CACpCT,IAAI,CAACa,wBAAwB,CAAC,CAAC,CAACC,IAAI,CAACC,IAAI,EAAI,CACzC,IAAI,CAACR,KAAK,CAACS,IAAI,CAACD,IAAI,CAAC,CACrB,IAAI,CAACE,QAAQ,CAAC,CAACR,SAAS,CAAE,OAAO,CAAC,CAAC,CACvC,CAAC,CAAC,CAACS,KAAK,CAACC,CAAC,EAAI,CACV,IAAI,CAACF,QAAQ,CAAC,CAACR,SAAS,CAAE,SAAS,CAAC,CAAC,CACrC,IAAI,CAACF,KAAK,CAACa,QAAQ,CAAC,CAAC,CACzB,CAAC,CAAC,CACN,CACJ,CAEAC,MAAMA,CAAA,CAAG,CACL,MAAO,KAAI,CAACb,KAAK,CAACC,SAAS,GAAK,OAAO,cACnCZ,KAAA,CAAAyB,aAAA,CAACpB,iBAAiB,CAAK,IAAI,CAACK,KAAQ,CAAC,cAAGV,KAAA,CAAAyB,aAAA,CAACnB,iBAAiB,CAAK,IAAI,CAACI,KAAO,CAAC,CACpF,CACJ,CAEA,KAAM,CAAAgB,eAAe,CAAIf,KAAK,EAAK,CAC/B,MAAO,CACHQ,IAAI,CAAER,KAAK,CAACQ,IAChB,CAAC,CACL,CAAC,CAED,KAAM,CAAAQ,kBAAkB,CAAIC,QAAQ,EAAK,CACrC,MAAO,CACHL,QAAQ,CAAEA,CAAA,GAAMK,QAAQ,CAAC,IAAM,CAAC1B,OAAO,CAAC2B,IAAI,CAAC,QAAQ,CAAC,EAAC,CAAC,CACxDV,IAAI,CAAGD,IAAI,EAAKU,QAAQ,CAACxB,UAAU,CAACe,IAAI,CAACD,IAAI,CAAC,CAClD,CAAC,CACL,CAAC,CAED,MAAO,CAAAjB,OAAO,CACVyB,eAAe,CACfC,kBACJ,CAAC,CAACpB,YAAY,CAAC,CACnB"},"metadata":{},"sourceType":"module"}